---
title: Go的GMP调度模型
date: 2024/05/23
desc: 🎉调度模型
tags: ['#全部','#Golang']
cover: https://cdn.jsdelivr.net/gh/RookieOHY/wallpaper/blogGo%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7%E6%80%9D%E8%80%83%E5%B0%81%E9%9D%A2.png
---

[[toc]]

<p align="center">
<img alt="封面" src="https://cdn.jsdelivr.net/gh/RookieOHY/wallpaper/blogcover.png" width=800 />
</p>

## 预备知识

### CPU

`Central Processing Unit`的缩写，意为中央处理单元，即处理器；负责**读取、执行指令**；和内存、寄存器打交道。
一个CPU有多个物理核心处理器，物理核心处理器可被**模拟为逻辑处理器**，逻辑处理器们**共享**物理核心处理器的**资源**。

### 时间片

一个cpu有多个核心，但核心数量远远小于应用程序的数量，靠多核心来支持程序的并发会造成等待。引入了时间片和轮转调度算法。

- 时间片即每个进程占用的时间段，大小范围20-50ms
  - 时间片结束，让渡cpu给其他进程，如程序逻辑没有执行完，放到一个就绪队列队尾，重新等待下一个时间片
  - 程序逻辑提前执行完毕或者阻塞，立即让渡给其他进程。
- 轮转调度指cpu高速运转下进程不断地切换

### 进程

进程即正在执行的程序，是操作系统动态执行的基本单元，是资源分配的最小单位，每个进程有自己的独立空间。

- 独立空间即虚拟内存空间，一个应用程序占一份
- 资源有CPU时间片、内存、磁盘IO等

进程间切换需要开销，体现为：

- 进程上下文切换
  - 上下文包括：寄存器、程序计数器、栈、虚拟内存地址、内核数据结构
- 硬件上下文切换

CPU是基于进程切换的，一个进程工作时，其他进程无法获得CPU资源！

> 不好：我写Word就不能同时听酷狗音乐了QAQ~

### 线程

引入线程以及切分更小的时间片，让cpu来回切换线程。

- 一个进程至少有一个线程
- 同一进程的线程共享本进程的地址空间和资源
- 每个线程都有自己独立的运行栈、程序计数器、一组寄存器

### 协程

协程即用户级别线程，存在、运行于用户空间，内核无感知也不参与调度、控制。

go里面的协程是：Goroutine，特点：

- 由go运行时管理
- 有go的GMP调度
- 协程间切换发生在用户态

## GMP模型

GPM是一种协程调度模型。模型组成：

- G
- P
- M

### G

### P

### M
